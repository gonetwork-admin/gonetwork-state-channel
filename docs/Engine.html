<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Class: Engine</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Class: Engine</h1>

    




<section>

<header>
    
        <h2><span class="attribs"><span class="type-signature"></span></span>Engine<span class="signature">(address, signatureService, blockchainService)</span><span class="type-signature"></span></h2>
        
            <div class="class-description">GoNetworks Engine encapsualtes off chain interactions between clients and propogation onto the blockchain.  
The Engine is platform agnostic and adaptble to different blockchains by providing appropriate blockchainService adapters
Overriding the send callback also allows for custom transport layers and methods (not neccessarily IP network based)</div>
        
    
</header>

<article>
    <div class="container-overview">
    
        

    
    <h2>Constructor</h2>
    

    
    <h4 class="name" id="Engine"><span class="type-signature"></span>new Engine<span class="signature">(address, signatureService, blockchainService)</span><span class="type-signature"></span></h4>
    

    











    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>address</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">your ethereum address; ETH Address is merely the last 20 bytes of the keccak256 hash of the public key given the public private key pair.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>signatureService</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            

            <td class="description last">the callback that requests the privatekey for signing of messages.  This allows the user to store the private key in a secure store or other means</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>blockchainService</code></td>
            

            <td class="type">
            
                
<span class="param-type">BlockchainService</span>


            
            </td>

            

            

            <td class="description last">a class extending the BlockchainService class to monitor and propogate transactions on chain. Override for different Blockchains</td>
        </tr>

    
    </tbody>
</table>






    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>msgID</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            
                <td class="default">
                
                    0
                
                </td>
            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>currentBlock</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            
                <td class="default">
                
                    0
                
                </td>
            

            <td class="description last">the current block which is synchronized to the onchain mined block value via blockchainService handler callbacks</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>publicKey</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last">Future Use: ElGamal Elliptic Curve Asymmetric Encryption public key to be sent to channel partners</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>initiatorStateMachine</code></td>
            

            <td class="type">
            
                
<span class="param-type">InitiatorFactory</span>


            
            </td>

            

            
                <td class="default">
                
                    stateMachine.IntiatorFactory
                
                </td>
            

            <td class="description last">creates a new state machine for mediated transfers you initiate</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>targeStateMachine</code></td>
            

            <td class="type">
            
                
<span class="param-type">TargetFactory</span>


            
            </td>

            

            
                <td class="default">
                
                    stateMachine.TargetFactory
                
                </td>
            

            <td class="description last">creates a new state machine for mediated transfers that are intended for you</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messageState</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            
                <td class="default">
                
                    {}
                
                </td>
            

            <td class="description last">tracks the state of mediated transfer messages using msgID as the key i.e. this.messageState[msgID] = stateMachine.*</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channelByPeer</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            
                <td class="default">
                
                    {}
                
                </td>
            

            <td class="description last">channels by peers ethereum address as hex string no 0x prefix</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channels</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            
                <td class="default">
                
                    {}
                
                </td>
            

            <td class="description last">channels by on-chain contract address hex string no 0x prefix</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pendingChannels</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            
                <td class="default">
                
                    {}
                
                </td>
            

            <td class="description last">used to track newChannel requests initiated by the engine</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>signatureService</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>blockchain</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line33">line 33</a>
    </li></ul></dd>
    

    

    

    
</dl>


















    
    </div>

    
        <h3 class="subsection-title">Extends</h3>

        


    <ul>
        <li>events.EventEmitter</li>
    </ul>


    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="approveChannel"><span class="type-signature"></span>approveChannel<span class="signature">(channelAddress, amount)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    approve the channel to take ERC20 deposits.  This must be called before a deposit can be made successfully.  This utlimately creates and allowance
for the channel on the ERC20 contract.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the on-chain nettingchannel address of the channel</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>amount</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the maximum amount of the ERC20 token to allow the channel to transfer when making a deposit.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line603">line 603</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onApprovalError(channelAddress) is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="approveChannelManager"><span class="type-signature"></span>approveChannelManager<span class="signature">(amount)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    Approve the channelManager to take the flat fee in GOT ERC20 tokens when a channel is created.  This only needs to be called once when the engine is initialized
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>amount</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the maximum allowance of GOT ERC20 tokens to allow the channelManager to transfer.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line627">line 627</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onApprovalError() is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="closeChannel"><span class="type-signature"></span>closeChannel<span class="signature">(channelAddress)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    close a channel given the peer ethereum address.  The close proof in the state is transferred during the call to close.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the on-chain nettingchannel address of the channel</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line453">line 453</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onChannelCloseError(channelAddress) is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="depositChannel"><span class="type-signature"></span>depositChannel<span class="signature">(channelAddress, amount)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    Deposit an amount of the ERC20 token into the channel on-chain.  After the transaction is mined successfully,
that amount will be available for net transfer in the channel. This is effectively the collateral locked up during the 
channel lifetime and cannot be freed until the channel is closed and settled.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the on-chain nettingchannel address of the channel</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>amount</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the amount of the ERC20 token to deposit.  The maxium amount of the cumulative deposits is determined by the allowance setup for the channel.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line575">line 575</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li>Engine.approveChannel</li>
        </ul>
    </dd>
    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onChannelNewBalanceError(channelAddress) is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="handleEvent"><span class="type-signature"></span>handleEvent<span class="signature">(event, state)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Internal event handlers triggered by state-machine workflows and blockchain events
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>event</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last">the GOT.* namespaced event triggered asynchronously by external engine components i.e. stateMachine, on-chain event handlers,etc.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>state</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            

            

            <td class="description last">the accompanying object state</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line302">line 302</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="newChannel"><span class="type-signature"></span>newChannel<span class="signature">(peerAddress)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    Create a new channel given the peer ethereum address
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>peerAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">eth address</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line425">line 425</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel is mined.  If there is an error during any point of execution in the mining
the onChannelNewError(peerAddress) is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="onApproval"><span class="type-signature"></span>onApproval<span class="signature">(owner, spender, value)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a ERC20 token approves someone for an allowance
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>owner</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>spender</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>value</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the allowance that was set</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line647">line 647</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onChannelClose"><span class="type-signature"></span>onChannelClose<span class="signature">(channelAddress, closingAddress)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a  channel is closed on chain identifying which of the partners initiated the close
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>closingAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line724">line 724</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onChannelNew"><span class="type-signature"></span>onChannelNew<span class="signature">(channelAddress, addressOne, addressTwo, settleTimeout-)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a new channel is created by the channel manager
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>addressOne</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>addressTwo</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>settleTimeout-</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the settle_timeout for the channel</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line661">line 661</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onChannelNewBalance"><span class="type-signature"></span>onChannelNewBalance<span class="signature">(channelAddress, address, balance)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a channel has tokens deposited into it on-chain
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>address</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">the particpants ethereum address in hexString who deposited the funds</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>balance</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">the new deposited balance for the participant in the channel</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line711">line 711</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onChannelSecretRevealed"><span class="type-signature"></span>onChannelSecretRevealed<span class="signature">(channelAddress, secret, receiverAddress)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a lock has been withdrawn on-chain.  If a user was withholding the secret in a mediate transfer,
the party can now unlock the pending locks in the other channels.  This is why it is essential in a mediated transfer setting
that each hop decrements the expiration by a safe margin such that they may claim a lock off chain in case of byzantine faults
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>secret</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">the 32 byte secret in hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>receiverAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString which unlocked the lock on-chain</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line769">line 769</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onChannelSettled"><span class="type-signature"></span>onChannelSettled<span class="signature">(channelAddress)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a channel is settled on-chain
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line755">line 755</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onMessage"><span class="type-signature"></span>onMessage<span class="signature">(message)</span><span class="type-signature"> &rarr; {<a href="message.Ack.html">message.Ack</a>}</span></h4>
    

    



<div class="description">
    Handle an incoming message after it has been deserialized
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>message</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="message.SignedMessage.html">message.SignedMessage</a></span>


            
            </td>

            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line83">line 83</a>
    </li></ul></dd>
    

    

    

    
</dl>











<h5>Throws:</h5>
<ul>
        <li>

    <div class="param-desc">
    
        "Invalid Message: no signature found"
    
    </div>

</li>
    
        <li>

    <div class="param-desc">
    
        "Invalid Message: uknown message received"
    
    </div>

</li>
    </ul>


<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="message.Ack.html">message.Ack</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="onRefund"><span class="type-signature"></span>onRefund<span class="signature">(channelAddress, receiverAddress, amount-)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a channel has been closed and the channel lifetime exceeds the refund interval.
i.e. channel.closedBlock - channel.openedBlock > refundInterval.  This is in hopes to incentives longer lived state channels
by reducing the cost of their deployment for longer periods.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>receiverAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString of the party that received the refund</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>amount-</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the amount of GOT refunded</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line783">line 783</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="onTransferUpdated"><span class="type-signature"></span>onTransferUpdated<span class="signature">(channelAddress, nodeAddress)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Callback when a the counterpary has updated their transfer proof on-chain
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">ethereum address hexString</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>nodeAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">String</span>


            
            </td>

            

            

            <td class="description last">the party who submitted the proof</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line744">line 744</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="send"><span class="type-signature"></span>send<span class="signature">(msg)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Send the message. Override this function to define different transport channels
e.g integrate this with TELEGRAMS Api and securely transfer funds between users on telegram.
Generate qrcodes for revelSecret message
or implement webRTC p2p protocol for transport etc.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>msg</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="message.html">message</a></span>


            
            </td>

            

            

            <td class="description last">A message implementation in the message namespace</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line294">line 294</a>
    </li></ul></dd>
    

    

    

    
</dl>


















        
            

    

    
    <h4 class="name" id="sendDirectTransfer"><span class="type-signature"></span>sendDirectTransfer<span class="signature">(to, transferredAmount)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Send a direct transfer to your channel partner.  This method calls send(directTransfer) and applies the directTransfer to the local channel state.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>to</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">eth address who this message will be sent to.  Only differs from target if mediating a transfer</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>transferredAmount</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the monotonically increasing amount to send.  This value is set by taking the previous transferredAmount + amount you want to transfer.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line267">line 267</a>
    </li></ul></dd>
    

    

    

    
</dl>











<h5>Throws:</h5>
<ul>
        <li>

    <div class="param-desc">
    
        "Invalid MediatedTransfer: unknown to address"
    
    </div>

</li>
    
        <li>

    <div class="param-desc">
    
        'Invalid DirectTransfer:state channel is not open'
    
    </div>

</li>
    </ul>







        
            

    

    
    <h4 class="name" id="sendMediatedTransfer"><span class="type-signature"></span>sendMediatedTransfer<span class="signature">(to, target, amount, expiration, secret, hashLock)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Send a locked transfer to your channel partner. This method intiatlizes a initator state machine which will queue the message for send via handleEvent
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>to</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">eth address who this message will be sent to.  Only differs from target if mediating a transfer</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>target</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">eth address of the target.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>amount</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">amount to lock and send.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>expiration</code></td>
            

            <td class="type">
            
                
<span class="param-type">BN</span>


            
            </td>

            

            

            <td class="description last">the absolute block number this locked transfer expires at.</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>secret</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">Bytes32 cryptographic secret</td>
        </tr>

    

        <tr>
            
                <td class="name"><code>hashLock</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">Bytes32 keccak256(secret) value.</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line231">line 231</a>
    </li></ul></dd>
    

    

    

    
</dl>











<h5>Throws:</h5>
<ul>
        <li>

    <div class="param-desc">
    
        "Invalid MediatedTransfer: channel does not exist"
    
    </div>

</li>
    
        <li>

    <div class="param-desc">
    
        'Invalid Channel State:state channel is not open'
    
    </div>

</li>
    </ul>







        
            

    

    
    <h4 class="name" id="settleChannel"><span class="type-signature"></span>settleChannel<span class="signature">(channelAddress)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    Settle the channel on-chain after settle_timeout time has passed since closing, unlocking the on-chain collateral and distributing the funds
according to the proofs and lock withdrawals on chain.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the on-chain nettingchannel address of the channel</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line546">line 546</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onChannelSettledError(channelAddress) is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="transferUpdate"><span class="type-signature"></span>transferUpdate<span class="signature">(channelAddress)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    Update the proof after you learn a channel has been closed by the channel counter party
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the on-chain nettingchannel address of the channel</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line482">line 482</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onTransferUpdatedError(channelAddress) is called
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="withdrawPeerOpenLocks"><span class="type-signature"></span>withdrawPeerOpenLocks<span class="signature">(channelAddress)</span><span class="type-signature"> &rarr; {Promise}</span></h4>
    

    



<div class="description">
    Issue withdraw proofs on-chain for locks that have had their corresponding secret revealed.  Locks can be settled on chain once a proof has been sent on-chain.
Locks can only be withdrawn once.
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>channelAddress</code></td>
            

            <td class="type">
            
                
<span class="param-type">Buffer</span>


            
            </td>

            

            

            <td class="description last">the on-chain nettingchannel address of the channel</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="engine.js.html">engine.js</a>, <a href="engine.js.html#line508">line 508</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Returns:</h5>

        
<div class="param-desc">
    - the promise is settled when the channel close request is mined.  If there is an error during any point of execution in the mining
the onChannelSecretRevealedError(channelAddress) is called for each lock that was not successfully withdrawn on-chain and must be reissued
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>


    </dd>
</dl>

    





        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Channel_.html">Channel</a></li><li><a href="channel.OpenLockProof.html">OpenLockProof</a></li><li><a href="ChannelState.html">ChannelState</a></li><li><a href="Engine.html">Engine</a></li><li><a href="MediatedTransferState.html">MediatedTransferState</a></li><li><a href="merkletree.MerkleTree.html">MerkleTree</a></li><li><a href="message.Ack.html">Ack</a></li><li><a href="message.DirectTransfer.html">DirectTransfer</a></li><li><a href="message.Hashable.html">Hashable</a></li><li><a href="message.Lock.html">Lock</a></li><li><a href="message.LockedTransfer.html">LockedTransfer</a></li><li><a href="message.MediatedTransfer.html">MediatedTransfer</a></li><li><a href="message.OpenLock.html">OpenLock</a></li><li><a href="message.Proof.html">Proof</a></li><li><a href="message.ProofMessage.html">ProofMessage</a></li><li><a href="message.RequestSecret.html">RequestSecret</a></li><li><a href="message.RevealSecret.html">RevealSecret</a></li><li><a href="message.SecretToProof.html">SecretToProof</a></li><li><a href="message.SignedMessage.html">SignedMessage</a></li><li><a href="MessageState.html">MessageState</a></li><li><a href="stateMachine.InitiatorFactory.html">InitiatorFactory</a></li><li><a href="stateMachine.TargetFactory.html">TargetFactory</a></li></ul><h3>Namespaces</h3><ul><li><a href="channel.html">channel</a></li><li><a href="merkletree.html">merkletree</a></li><li><a href="message.html">message</a></li><li><a href="stateMachine.html">stateMachine</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Apr 29 2018 00:24:37 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>